<mat-sidenav-container class="dashboard-container">
  <mat-sidenav #sidenav mode="side" opened class="dashboard-sidenav">
    <mat-nav-list>
      <a
        mat-list-item
        [attr.aria-current]="selectedSection === 'user' ? 'page' : null"
        [ngClass]="{ 'active-section': selectedSection === 'user' }"
        (click)="selectedSection = 'user'"
      >
        <mat-icon>person</mat-icon>
        <span>Usuario</span>
      </a>

      <a
        mat-list-item
        [attr.aria-current]="selectedSection === 'expenses' ? 'page' : null"
        [ngClass]="{ 'active-section': selectedSection === 'expenses' }"
        (click)="selectedSection = 'expenses'"
      >
        <mat-icon>table_chart</mat-icon>
        <span>Gastos</span>
      </a>

      <ng-container *ngIf="(user$ | async)?.rol === 'ADMIN'">
        <a
          mat-list-item
          [attr.aria-current]="selectedSection === 'cards' ? 'page' : null"
          [ngClass]="{ 'active-section': selectedSection === 'cards' }"
          (click)="selectedSection = 'cards'"
        >
          <mat-icon>credit_card</mat-icon>
          <span>Tarjetas</span>
        </a>
      </ng-container>

      <a
        mat-list-item
        [attr.aria-current]="selectedSection === 'summary' ? 'page' : null"
        [ngClass]="{ 'active-section': selectedSection === 'summary' }"
        (click)="selectedSection = 'summary'"
      >
        <mat-icon>assessment</mat-icon>
        <span>Resumen</span>
      </a>
    </mat-nav-list>
  </mat-sidenav>

  <mat-sidenav-content>
    <div *ngIf="popupMessage" class="popup-message" [ngClass]="popupType">
      {{ popupMessage }}
      <button class="close-btn" (click)="closePopup()">&times;</button>
    </div>

    <div class="dashboard-content">
      <!-- Usuario -->
      <section *ngIf="selectedSection === 'user'">
        <!-- If ADMIN: show users CRUD table, otherwise show personal info -->
        <ng-container *ngIf="(user$ | async)?.rol === 'ADMIN'; else personalInfo">
          <app-users></app-users>
        </ng-container>
        <ng-template #personalInfo>
          <mat-card>
            <mat-card-title>Datos del Usuario</mat-card-title>
            <mat-card-content>
              <ng-container *ngIf="user$ | async as user; else noUser">
                <div><strong>Nombre:</strong> {{ user.name }}</div>
                <div><strong>Email:</strong> {{ user.email }}</div>
                <div><strong>Rol:</strong> {{ user.rol }}</div>
              </ng-container>
              <ng-template #noUser>
                <div class="muted">No hay datos de usuario.</div>
              </ng-template>
            </mat-card-content>
          </mat-card>
        </ng-template>
      </section>

      <!-- Tarjetas (solo ADMIN) -->
      <app-cards
        *ngIf="selectedSection === 'cards' && (user$ | async)?.rol === 'ADMIN'"
      ></app-cards>

      <!-- Gastos -->
      <app-expenses *ngIf="selectedSection === 'expenses'"></app-expenses>

      <!-- Resumen -->
      <section *ngIf="selectedSection === 'summary'">
        <mat-card class="summary-card">
          <mat-card-title>Resumen de Gastos</mat-card-title>
          <mat-card-content>
            <div><strong>Total Gastado:</strong> ${{ resumen.totalGastado }}</div>
            <div><strong>Número de Transacciones:</strong> {{ resumen.numTransacciones }}</div>
            <div><strong>Promedio por Día:</strong> ${{ resumen.promedioDia }}</div>
          </mat-card-content>
        </mat-card>
      </section>
    </div>
  </mat-sidenav-content>
</mat-sidenav-container>
